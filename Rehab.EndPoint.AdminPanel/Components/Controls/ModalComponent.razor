
@typeparam TModel

@if (IsVisible)
{
    <div class="modal-backdrop">
        <div class="modal-content">
            <h3>@Title</h3>
            <EditForm Model="Model" OnValidSubmit="HandleValidSubmit">
                <AntiforgeryToken></AntiforgeryToken>
                <DataAnnotationsValidator />
                <ValidationSummary />

                @if(ChildContent != null)
                {
                    @ChildContent
                }

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">Apply Changes</button>
                    <button type="button" class="btn btn-secondary" @onclick="Close">Cancel</button>
                </div>
            </EditForm>
        </div>
    </div>
}
@code {
    [Parameter] public string Title { get; set; }
    [Parameter] public TModel Model { get; set; }
    [Parameter] public RenderFragment ChildContent { get; set; }
    [Parameter] public EventCallback<TModel> OnValidSubmit { get; set; }

    public bool IsVisible { get; set; }

    public void Show() => IsVisible = true;
    public void Close() => IsVisible = false;

    private async Task HandleValidSubmit()
    {
        await OnValidSubmit.InvokeAsync(Model);
        Close();
    }
}
