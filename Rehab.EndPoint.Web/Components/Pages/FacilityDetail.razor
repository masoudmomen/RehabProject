@page "/facility/{slug}"
@rendermode InteractiveServer
@using Rehab.EndPoint.Web.ViewModels
@using Rehab.EndPoint.Web.Components.Common
@using Rehab.EndPoint.Web.Components.Facility

<div class="mt-5">
    @if (facility != null)
    {
        <PageCover CustomImageUrl="@facility.Cover"
                   CustomLogoURL="@facility.Logo"
                   PageTitle="@facility.Name" />

        <div class="shadow position-relative py-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-6">
                        <FacilityGeneralInfo Facility="@facility" />
                    </div>
                    <div class="col-md-6">
                        <FacilityGallery Facility="@facility" />
                    </div>

                </div>
            </div>
        </div>

        <div class="bg-white shadow position-relative z-1  py-5">
            <div class="container facility-tab insurance">
                <TabControl @ref="tabControl1">
                    <Tab Title="Insurances">
                        <div class="cards-grid">
                            @foreach (var item in facility.Insurances)
                            {
                                <Card Title="@item.Name"
                                      Image="@item.Logo"
                                      Description="@item.Description"
                                      CardLink="#" />
                            }
                        </div>

                    </Tab>
                    <Tab Title="Accreditation">
                        <div class="cards-grid">
                            @foreach (var item in facility.Accreditations)
                            {
                                <Card Title="@item.Name"
                                      Image="@item.Logo"
                                      Description="@item.Description"
                                      CardLink="#"
                                      IconClass="fa-solid fa-certificate" />
                            }
                        </div>
                    </Tab>
                </TabControl>
            </div>
        </div>
        <div class="container mt-5 facility-tab">
            <TabControl @ref="tabControl2">
                <Tab Title="Amenities">
                    @foreach (var item in facility.Amenities)
                    {
                        <ItemRowComponent Title="@item.Name"
                                          Image="@item.Logo"
                                          Description="@item.Description"
                                          IconClass="fa-solid fa-person-swimming" />
                    }

                </Tab>
                <Tab Title="Hilights">
                    @foreach (var item in facility.Highlights)
                    {
                        <ItemRowComponent Title="@item.Name"
                                          Image="@item.Logo"
                                          Description="@item.Description"
                                          IconClass="fa-solid fa-star" />
                    }
                </Tab>
            </TabControl>
        </div>
        <div class="bg-white shadow py-5">
            <div class="container mt-5 facility-tab wwt">
                <TabControl @ref="tabControl3">
                    <Tab Title="Who We Treat">
                        <div class="cards-grid">
                            @foreach (var item in facility.Wwt)
                            {
                                <Card Title="@item.Name"
                                      Image="@item.Logo"
                                      Description="@item.Description"
                                      IconClass="fa-solid fa-hands-helping" />
                            }
                        </div>
                    </Tab>
                    <Tab Title="Treatments">
                       @foreach (var item in facility.Treatments)
                        {
                            <ItemRowComponent Title="@item.Name"
                                              Image="@item.Logo"
                                              Description="@item.Description"
                                              IconClass="fa-solid fa-hand-holding-medical" />
                        }
     
                    </Tab>
                    <Tab Title="Level Of Cares">
                        <div class="cards-grid loc">
                        @foreach(var item in facility.Locs)
                        {
                            <Card Title="@item.Name"
                                              Image="@item.Logo"
                                              Description="@item.Description"
                                              IconClass="fa-solid fa-layer-group" />
                        }
                        </div>
                        </Tab>
                </TabControl>
            </div>
        </div>
        <div class="container mt-5 facility-tab">
            <TabControl @ref="tabControl4">
                <Tab Title="Conditions">
                    @foreach(var item in facility.Condition)
                    {
                        <ItemRowComponent Title="@item.Name"
                                          Image="@item.Logo"
                                          Description="@item.Description"
                                          IconClass="fa-solid fa-notes-medical" />
                    }
     
                </Tab>
                <Tab Title="Substances">
                    @foreach(var item in facility.Swt)
                    {
                        <ItemRowComponent Title="@item.Name"
                                          Image="@item.Logo"
                                          Description="@item.Description"
                                          IconClass="fa-solid fa-pills" />
                    }
                    </Tab>
            </TabControl>
        </div>
    }

</div>


@code {
    [Parameter] public string slug { get; set; } = string.Empty;
    private FacilityViewModel? facility;
    private bool isLoading = true;
    private TabControl? tabControl1;
    private TabControl? tabControl2;
    private TabControl? tabControl3;
    private TabControl? tabControl4;

    protected override void OnInitialized()
    {
        if (!string.IsNullOrEmpty(slug))
        {
            if (!string.IsNullOrWhiteSpace(slug))
            {
                facility = MockFacilityData.GetSampleFacilities()
                           .FirstOrDefault(f => string.Equals(f.Slug, slug, StringComparison.OrdinalIgnoreCase)
                           || string.Equals(ToSlug(f.Name), slug, StringComparison.OrdinalIgnoreCase));
            }
        }

        isLoading = false;
    }
    private static string ToSlug(string? value)
    {
        if (string.IsNullOrWhiteSpace(value)) return string.Empty;
        return System.Text.RegularExpressions.Regex.Replace(value.Trim(), "\\s+", "-");
    }

}
