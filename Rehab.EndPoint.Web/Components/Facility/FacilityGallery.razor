@using Rehab.EndPoint.Web.ViewModels
@using System.Linq

@if (Facility?.FacilityImages != null && Facility.FacilityImages.Any())
{
           var imagesJson = System.Text.Json.JsonSerializer.Serialize(
            Facility.FacilityImages.Select(img => new
            {
                imageAddress = img.ImageAddress,
                title = img.Title
            })
        );
        var galleryId = $"facilityGallery_{Guid.NewGuid()}";
   
         <div id="@galleryId"
         class="facility-gallery-grid"
         data-images='@imagesJson'>

        @for (int i = 0; i < Facility.FacilityImages.Count && i < 4; i++)
        {
            var img = Facility.FacilityImages[i];
            var remainingImage = Facility.FacilityImages.Count - 4;

            <div class="facility-gallery-item" onclick="openLightbox('@galleryId', @i)">
                <img src="@img.ImageAddress" alt="@img.Title" />
                @if (i == 3 && remainingImage > 0)
                {
                    <div class="overlay">
                        <span>+@remainingImage more</span>
                    </div>
                }
            </div>
        }
    </div>

    <!-- Lightbox Modal -->
    <div class="modal fade" id="lightboxModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content bg-transparent border-0 shadow-none">
                <div class="modal-body text-center p-0">
                    <img id="lightboxImage" src="" alt="" class="img-fluid rounded" />
                </div>
                <div class="modal-footer justify-content-between border-0">
                    <button class="gallery-btn" onclick="prevImage()">‹ Prev</button>
                    <button class="gallery-btn" onclick="nextImage()">Next ›</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public FacilityViewModel Facility { get; set; } = new FacilityViewModel();
}
